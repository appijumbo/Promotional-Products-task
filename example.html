<!--
	Requirements: Without modifying the html below, use JS(and Jquery if you like) to fetch the 4 cheapest products which have an offer.
	The returned products need to be stored in an array of objects, and placed in a method of storage(up to you - maybe local?), that you can access on another page for display.
	Data and format we need for each product:
		- Product SKU
		- Product Title (Just the title, Without any offer information and without any padding)
		- Product Url
		- Product Image Url
		- Product price as a float value (without currency or padding)
		- The offer Text for the product (without padding)

	The Products must be ordered from lowest to highest price
	Only 4 Products should be stored
-->
<html>
	<head>
		<title>Test Page</title>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		<script>
		console.log("javascript running ok");

		/***********
		Approach 1

		  1) Scan list and identify products with offers.

		  If an offer found store data-sku of the 4 lowest priced with offers by only storing 4 and
		  removing the highest value

		  2) Using the use the data-sku, identify artcles containing all the product data.
		     Convert into appropriate type and correct data format, saving into an array of objects

		  3) Put this array into localStorage. Check this can be accessed on another page

		----

		Approach 2 (modified)

		1) Go through every article containing an offer and save its data, modified and sanitised, into an array of objects.

		2) Sort through the array ordering by the lowest to highest value products

		3) Split this array to just have first 4 and put this array into localStorage for viwing on other page


		** Approach 2 adopted **
		*********************************************/

		/* switch to jQuery because solution seemes more direct */
    /* Not using strict ES5 mode, not an issue in ES6 */

		/* closure to avoid globals (ES5) plus ensure jquery ready)*/
		(function(document, $){

		allOffers = [];


		  function aquireOffers(){

		    var article = $('.offer');

		  	$('.offer').each(function(index){ // Sanitise data and save to an object
		  		var parent = article[index].parentElement;
		  		var title = $(parent).find("h3")[0].childNodes[0].data.trim();
		  		var sku = $(parent).attr( "data-sku");
		      var url = $(parent).find('img').attr('src');


		      //var priceData = $(parent).find('span.price')[0].childNodes[0].data;
		      var priceStr = $(parent).find('span.price').html();
		      // https://regex101.com/   an   http://bit.ly/2AMzpgA
		      var priceClean = parseFloat(priceStr.replace(/[£,\s, p]+/g,""));
		      if(priceStr.match(/[p]+/g)){
		        console.log("real price is = "+ priceClean/100);
		        priceClean = priceClean/100;
		      };

		      var offerStr = $(parent).find('span.offer').html().trim();

		  		var productObj = {
		  			SKU: sku,
		  			Title: title,
		  			Url: url,
		  			Price:priceClean,
		  			Offer:offerStr
		      };

		        /** push this object to create array storage **/
		        allOffers.push(productObj);


		  	});

		    console.log(allOffers);

		  }


		/** Sort Array in order of Price lowest to highest **/
		function sortOffers(){

		  console.log("allOffers before sort " + JSON.stringify(allOffers));

		  allOffers.sort(function(a, b){
		      return a.Price-b.Price
		  })
		  console.log("allOffers after sort  " + JSON.stringify(allOffers));
		  console.log("Offers sorted -->/n");
		  console.log(allOffers);
		};

		/** Slice array keeping the first 4 prices **/
		function lowestFourOffers(){
		var theLowestOffers = allOffers.slice(0, 4);
		console.log("theLowestOffers" + JSON.stringify(theLowestOffers));
		return JSON.stringify(theLowestOffers);

		};


		/** Save array on localStorage  **/
		function lowestToLocal(){
		  console.log("Save lowest 4 offers to local");
		  localStorage.setItem('lowestFourOffers', lowestFourOffers());
		};

/** make sure the script only works when the rest of the DOM has downloaded **/
window.onload = function(){
		  aquireOffers();
		  sortOffers();
		  lowestToLocal();
};

		  })(window.document, jQuery);
		</script>

	</head>
	<body>
		<h1>Promotional Products</h1>
		<ul class="nav">
			<li><a href="/">Home</a></li>
			<li><a href="/cat1">Category 1</a></li>
			<li><a href="/cat2">Category 2</a></li>
			<li><a href="/cat3">Category 3</a></li>
		</ul>
		<ul class="products">

			<li class="product">
				<article data-sku="1001">
					<a href="/sku1001">
						<img src="img/image1.png" />
						<h3>Mature Cheddar</h3>
					</a>
					<span class="price"> &pound; 1.99</span>
					<span class="offer">3 for £5</span>
					<button class="buyBtn">Buy Now</button>
				</article>
			</li>

			<li class="product">
				<article data-sku="1234">
					<a href="/sk1234">
						<img src="img/image2.png" />
						<h3>Mild Cheddar</h3>
					</a>
					<span class="price"> &pound; 1.99</span>
					<button class="buyBtn">Buy Now</button>
				</article>
			</li>

			<li class="product">
				<article data-sku="4321">
					<a href="/sku4321">
						<img src="img/image3.png" />
						<h3>Pork Sausages</h3>
					</a>
					<span class="price"> &pound; 2.99</span>
					<span class="offer">2 for £5</span>
					<button class="buyBtn">Buy Now</button>
				</article>
			</li>

			<li class="product">
				<article data-sku="1213">
					<a href="/sku1213">
						<img src="img/image4.png" />
						<h3>Chicken Fillets</h3>
					</a>
					<span class="price"> &pound;3.50</span>
					<button class="buyBtn">Buy Now</button>
				</article>
			</li>

			<li class="product">
				<article data-sku="1421">
					<a href="/sku1421">
						<img src="img/image5.png" />
						<h3><span>New!</span>Low Fat Yoghurt</h3>
					</a>
					<span class="price"> 99p</span>
					<button class="buyBtn">Buy Now</button>
				</article>
			</li>

			<li class="product">
				<article data-sku="1845">
					<a href="/sku1845">
						<img src="img/image6.png" />
						<h3>Tomato Soup</h3>
					</a>
					<span class="price">£1</span>
					<span class="offer">3 for £2</span>
					<button class="buyBtn">Buy Now</button>
				</article>
			</li>

			<li class="product">
				<article data-sku="1953">
					<a href="/sku1953">
						<img src="img/image7.png" />
						<h3>Chicken Soup</h3>
					</a>
					<span class="price"> &pound; 1.99</span>
					<button class="buyBtn">Buy Now</button>
				</article>
			</li>

			<li class="product">
				<article data-sku="2532">
					<a href="/potatosoup/">
						<img src="img/image8.png" />
						<h3>Leek and Potato Soup</h3>
					</a>
					<span class="price">&pound;0.75</span>
					<span class="offer">Was &pound;1.99</span>
					<button class="buyBtn">Buy Now</button>
				</article>
			</li>

			<li class="product">
				<article data-sku="1736">
					<a href="/sku1736">
						<img src="img/image9.png" />
						<h3>Diet Cola</h3>
					</a>
					<span class="price"> &pound; 1.50</span>
					<span class="offer">3 for £5</span>
					<button class="buyBtn">Buy Now</button>
				</article>
			</li>

			<li class="product">
				<article data-sku="4331">
					<a href="/sku4331">
						<img src="img/image10.png" />
						<h3>Orange Juice <span> Meal Deal! </span></h3>
					</a>
					<span class="price"> 70p</span>
					<span class="offer">Breakfast Meal Deal</span>
					<button class="buyBtn">Buy Now</button>
				</article>
			</li>

		</ul>
		<h3>
			Other Links
		</h3>
		<ul class="footerLinks">
			<li><a href="/">Home</a></li>
			<li><a href="/cat1">Category 1</a></li>
			<li><a href="/cat2">Category 2</a></li>
			<li><a href="/cat3">Category 3</a></li>
		</ul>

		<style>
		.nav, .footerLinks { background: #e2e2e2; padding: 10px 0px; }
		ul { float: left; width: 100%; list-style-type: none;}
		ul li { float: left; width: 200px; margin: 10px;text-align: center; border: 1px solid #e2e2e2; padding-bottom: 10px;}
		span.offer, h3 span { color: red; }
		</style>
	</body>
</html>
